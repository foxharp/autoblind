<h1>autoblind -- window blind automation, using an XOStick.</h1>
<h2>background</h2>
<p>about 15 years ago i bought some surplus Makita drapery motors
(http://tinyurl.com/bqpafrt), figured out how to use them, and
then never did anything with them.</p>
<p>in the meantime, i've done a lot of embedded programming,
including on AVR micros.  when OLPC decided to use some extra
circuit board space to create the XO Stick boards
(http://wiki.laptop.org/go/XO_Stick), i wanted to build something
with one of them, and i remembered my motors.  we've lost some
trees around the house lately, so the privacy afforded by the
bedroom window blinds has become more important.  it seemed like
the right time for some automation.</p>
<p>and now, in the morning, i can open the blinds at either end of
the room to see what it's like outside before i ever get out of
bed.</p>
<h2>the project</h2>
<p>the complete project gives full up/down control of a single
window blind.  (i've built two, one for each window.) the blind
can be controlled with a button mounted near the window (mine are
clipped to the curtain), or from a recycled IR remote.  there are
commands to raise and lower the blind.  three preset positions
may be configured for one-touch adjustment.  there's provision
for a hard limit switch, so that a runaway motor won't drag the
blind off the window.  there's also a serial console port with a
simple command-line interface, very useful for development and
debugging.</p>
<p>it's all written in C, using avr-gcc.  the processor on the XO
Stick is an ATtiny861.  it does <em>not</em> use any of the USB
capabilities of the XO Stick, for either booting or operation.  i
have a USBTiny programmer for programming, and there's no need
for USB for this project.  it also doesn't use any of the Arduino
libraries -- it's all in raw C.</p>
<p>while my particular application is fairly specific to my needs, i
tried to write the main loop and the IR, button, timer, and
software-driven uart modules in a fairly generic way, for ease of
reuse.</p>
<h2>the hardware</h2>
<p>the XO Stick is described here http://wiki.laptop.org/go/XO_Stick
and here http://cananian.livejournal.com/66129.html.  while the
XOrduino is way more powerful, it's overkill for most of my home
project needs, it's more expensive, and it's much harder to
solder together.  in addition, the XO Stick has some on-board
prototyping area which is very useful for the inevitable extra
components that come along with any project.</p>
<p>XO stick top:<br />
<img alt="image of XO stick top" src="pix/xo_stick_top.png" /></p>
<p>XO stick bottom:<br />
<img alt="image of XO stick bottom" src="pix/xo_stick_bottom.png" /></p>
<p>in addition to the XO Stick itself, i needed a limit switch that
could be triggered somehow by something attached to the cord on
the blind, an IR sensor, and an external pushbutton.  i built the
IR sensor and the button into the same little module, small
enough to be clipped to the curtain.  i reused the clip from a
badge holder that i got at some conference or other, and the
"case" for the module is the transparent plastic box that once
held an SD card.</p>
<p>IR sensor:<br />
<img alt="image of IR sensor" src="pix/ir_sensor.png" /></p>
<p>for the limit switch, i initially made my own magnetic sensor
from an old reed switch and some aluminum tubing.</p>
<p>Limit switch:<br />
<img alt="image of Limit switch" src="pix/limit_switch.png" /></p>
<p>i mounted that parallel to and even with the bottom of the window
sill, and triggered it with a magnet fastened to the blind cord. 
that worked, but was harder to mount that i'd like.  i think i'll
explore using a standard burglar-alarm style magnetic sensor
next.</p>
<p>the motors themselves include an odd combination of digital
hardware.  there's some 12V logic that includes closure-to-ground
control for motor on/off and direction control.  there's also a
5V circuit that drives a per-rotation pulse.</p>
<p>Motor internals:<br />
<img alt="image of Motor internals" src="pix/sj_vase_tamil.png" /></p>
<p>i tapped into that 5V supply for the XO Stick power.  the
per-rotation pulse was useable directly, and i used a couple of
mosfets for the closure to ground inputs to the motor.  i may
have been able to do something simpler, but mosfets are pretty
simple, and i wasn't sure exactly what kind of logic family i was
connecting to.</p>
<h2>schematics</h2>
<p>the <a href="./XO-Stick2-sch.pdf">XO Stick schematic</a> itself describes
most of the project.</p>
<p>the schematic for the IR receiver can practically be read from
the <a href="/pix/carbonator.png">photo</a>, but here's a rough diagram:</p>
<pre><code>    +---+   Panasonic PNA4602M or Sharp GP1UX511QS IR receiver
    | O |   (looking at the front)
    |   |
     TTT    pin 3 is Vcc
     123    pin 2 is GND
     |||    pin 1 is Vout
     |||
     ||+----+---------------- Vcc
     ||     |
     ||    ===  .1uf bypass cap
     ||     |
     |+-----+-----------------  ground     
     ||
     |+----+PB+---------------  push button
     |
     +------------------------  IR output
</code></pre>
<p>the pinouts i chose for the three connectors are</p>
<pre><code> LED end                                        cable color
 of board                                       ----------
               6-pin, to motor
                    GND                         black
                    MOTOR_DIR       PA1         green
                    MOTOR_ON        PA0         blue
                    nc
                    MOTOR_TURN      PA2         brown
                    +5                          red

                2-pin, to limit switch
                    LIMIT           PA3         yellow
                    GND                         black

                4-pin, to IR sensor
                    GND                         black
                    BUTTON          PB2         yellow
                    IR              PA4         green
                    +5                          red
  USB end
  of board
</code></pre>